% MCM/ICM 2026 LaTeX 主控文件
% 编译方式：XeLaTeX + Biber（推荐用latexmk自动编译）
% !TEX program = xelatex
% !BIB program = biber

\documentclass{mcmthesis}

% 兼容性补丁：避免旧aux残留的chapter计数器导致hyperref报错
\newcounter{chapter}
\renewcommand{\thechapter}{\arabic{chapter}}

% MCM题目配置（比赛时务必修改tcn为真实队号）
\mcmsetup{
    tcn = {2617892},
    problem = {C},
    sheet = true,
    titleinsheet = true,
    keywordsinsheet = true,
    titlepage = false
}

% 目录开关
\makeatletter
\@ifundefined{showtoctrue}{}{\showtoctrue}
\makeatother

%=== 宏包加载 ===

% 字体与排版
\usepackage{palatino}
\usepackage{microtype}
\setlength{\emergencystretch}{2em}

% 页面与布局
\usepackage{lastpage}
\usepackage{zref-abspage}
\usepackage{float}
\usepackage{geometry}
\setlength{\headheight}{15pt}

% 数学公式
\usepackage{amsmath, amssymb, amsthm}
\usepackage{mathtools}

% 表格美化
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{array}
\usepackage{threeparttable}

% 算法伪代码（顶会风格）
\usepackage[ruled, vlined, linesnumbered]{algorithm2e}
\SetAlgorithmName{Algorithm}{algorithm}{List of Algorithms}
\SetKwInput{KwIn}{Input}
\SetKwInput{KwOut}{Output}
\SetKwInput{KwData}{Data}
\SetKwInput{KwResult}{Result}

% 代码高亮
\usepackage{listings}
\lstset{
    basicstyle=\small\ttfamily,
    keywordstyle=\color{blue},
    commentstyle=\color{gray},
    numbers=left,
    numberstyle=\tiny\color{gray},
    frame=single,
    breaklines=true,
    tabsize=4
}

% 图形与颜色
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{shapes, arrows, positioning, calc}

% 列表与枚举
\usepackage{enumitem}
\setlist[enumerate]{itemsep=0pt, parsep=0pt}

% 彩色框（用于重点内容）
\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}

% 超链接（最后加载）
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    citecolor=green!50!black,
    urlcolor=blue!80!black
}

% 目录格式调整（紧凑行距）
\usepackage{tocloft}
\setlength{\cftbeforesecskip}{2pt}
\setlength{\cftbeforesubsecskip}{1pt}

% 参考文献
\usepackage[backend=biber, style=ieee, sorting=none]{biblatex}
\addbibresource{ref.bib}

%=== 自定义命令 ===

% 正文页数计数器（实现 Page X of Y）
\newcounter{mainpages}
\makeatletter
\newcommand{\savemainpages}{%
    \immediate\write\@auxout{\string\setcounter{mainpages}{\the\value{page}}}%
}
\makeatother

% 快捷引用命令
\newcommand{\figref}[1]{Fig.~\ref{#1}}
\newcommand{\tabref}[1]{Table~\ref{#1}}
\newcommand{\eqnref}[1]{Eq.~(\ref{#1})}
\newcommand{\algref}[1]{Algorithm~\ref{#1}}
\newcommand{\secref}[1]{Section~\ref{#1}}

%=== 文档元信息 ===

\title{Inferring Fan Votes from Elimination Data: \\ 
       A Dual-Core Inversion Framework with Anomaly Detection \\
       and Mechanism Design for \emph{Dancing with the Stars}}
\author{Team \#2617892}

%=== 正文开始 ===
\begin{document}

% Summary Sheet（摘要页，不计入页数）
\pagenumbering{arabic}
\setcounter{page}{0}
\pagestyle{empty}
\input{sections/00_abstract.tex}
\maketitle
\thispagestyle{empty}

% Memo to DWTS Director（备忘录，紧随摘要页）
\input{sections/memo.tex}

% Contents（目录页，从第1页开始但不显示页码）
\newpage
\setcounter{page}{1}
\pagestyle{empty}
\tableofcontents
\thispagestyle{empty}

% 正文开始（从第3页开始显示页眉页码）
\newpage
\setcounter{page}{3}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\small Team \#2617892}
\fancyhead[R]{\small Page \thepage\ of \themainpages}
\fancyfoot[C]{}

% Section 1: Introduction
\input{sections/01_intro.tex}

% Section 2: Assumptions and Justifications
\input{sections/02_assumptions.tex}

% Section 3: Notations
\input{sections/03_notations.tex}

% Section 4: Model 1 - Fan Vote Inversion
\input{sections/04_model1.tex}

% Section 5: Model 2 - Survival & Feature Analysis
\input{sections/05_model2.tex}

% Section 6: Model 3 - Mechanism Design
\input{sections/06_model3.tex}

% Section 7: Sensitivity and Robustness
\input{sections/07_sensitivity.tex}

% Section 8: Model Evaluation
\input{sections/08_evaluation.tex}

% Section 9: Conclusion and Recommendations
\input{sections/09_conclusion.tex}

% References
\newpage
\nocite{*}
\printbibliography[heading=bibintoc, title={References}]

% 保存正文总页数
\savemainpages

% Appendices（附录不计入25页限制）
\clearpage
\appendix
\pagenumbering{gobble}
\pagestyle{plain}

\input{appendices/appendix_code.tex}
\newpage
\input{appendices/appendix_figures.tex}
\newpage
\input{appendices/ai_report.tex}

\end{document}
